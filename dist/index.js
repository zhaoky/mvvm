/*! @korey/mvvm v1.0.0 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mvvm=t():e.mvvm=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e){return Array.isArray(e)}function h(e){return"[object Object]"===Object.prototype.toString.call(e)}function p(e){return 1===e.nodeType}function d(e){return 3===e.nodeType}function v(e,t){return e.hasAttribute(t)}function b(e,t){return e.getAttribute(t)||""}function y(e,t,n){if(null==n||!1===n)return m(e,t);!0===n?(e[t]=n,v(e,t)||e.setAttribute(t,"")):n!==b(e,t)&&e.setAttribute(t,n)}function m(e,t){e.removeAttribute(t)}function g(e,t){var n=e.classList;return n?n.contains(t):(" "+b(e,"class")+" ").indexOf(" "+t+" ")>-1}function O(e){return 0===e.indexOf("v-")}function k(e){if(p(e)&&e.hasAttributes()){for(var t=e.attributes,n=0;n<t.length;n++)if(O(t[n].name))return!0}else if(d(e)&&/(\{\{.*\}\})/.test(e.textContent))return!0}function w(e){return v(e,"v-if")||v(e,"v-for")}function _(e,t){var n=e.style;if(!h(t))return warn("v-style for style must be a type of Object",t);Object.keys(t).forEach(function(e){n[e]!==t[e]&&(n[e]=t[e])})}n.r(t),n.d(t,"MVVM",function(){return P});var j=null,x=0,P=function e(t){if(l(this,e),!h(t))throw Error("data must be object.");if(!t.view||t.view&&!p(t.view))throw Error("data.view must be HTMLDivElement.");if(!t.model||t.model&&!h(t.model))throw Error("data.model must be object.");new $(t)},$=function(){function e(t){l(this,e),this.$queue=[],this.$element=t.view,this.$data=t.model,this.$context=this,this.$done=!1,E.createObserver(this.$data),this.$fragment=function(e){for(var t,n=document.createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}(this.$element),this.collectDir(this.$fragment,!0)}return c(e,[{key:"collectDir",value:function(e,t,n){var r=this;t&&k(e)&&this.$queue.push([e,n]);for(var i=e.childNodes,o=i.length,u=0;u<o;u++){var s=i[u],a=s.nodeType;1!==a&&3!==a||(k(s)&&this.$queue.push([s,n]),s.hasChildNodes()&&!w(s)&&this.collectDir(s,!1,n))}t&&(this.$queue.map(function(e){r.compileNode(e)}),this.completed())}},{key:"compileNode",value:function(e){var t=this,n=e[0],r=e[1];if(p(n)){for(var i=[],o=n.attributes,u=o.length,s=0;s<u;s++){var a=o[s];if(O(a.name)){if("v-for"===a.name){i=[a];break}i.push(a)}}i.map(function(e){t.parseAttr(n,e,r)})}else d(n)&&this.parseText(n,r)}},{key:"parseAttr",value:function(e,t,n){var r=t.name,i=t.value,o=r.substr(2);m(e,r);var u=this.selectParsers(o,e,i,this),s=new T(u,n);u.update(s.value)}},{key:"parseText",value:function(e,t){}},{key:"selectParsers",value:function(e,t,n,r){var i;switch(e){case"text":i=new A(t,n,r);break;case"style":i=new L(t,n,r);break;case"class":i=new C(t,n,r);break;case"for":i=new V(t,n,r);break;default:i=new N(t,n,r)}return i}},{key:"completed",value:function(){this.$done||(this.$done=!0,this.$element.appendChild(this.$fragment),delete this.$fragment)}}]),e}(),S=function(){function e(t,n,r){l(this,e),this.el=t,this.vm=r,this.dirValue=n}return c(e,[{key:"update",value:function(){}}]),e}(),A=function(e){function t(e,n,r){return l(this,t),i(this,o(t).call(this,e,n,r))}return u(t,S),c(t,[{key:"update",value:function(e){var t;this.el.textContent=null==(t=e)?"":t.toString()}}]),t}(),L=function(e){function t(e,n,r){return l(this,t),i(this,o(t).call(this,e,n,r))}return u(t,S),c(t,[{key:"update",value:function(e,t){if(t){var n=Object.keys(t);return n.map(function(e){n[e]=""}),void _(this.el,e)}_(this.el,e)}}]),t}(),C=function(e){function t(e,n,r){return l(this,t),i(this,o(t).call(this,e,n,r))}return u(t,S),c(t,[{key:"update",value:function(e,t){var n=this;t&&t.split(" ").map(function(e){!function(e,t){var n,r,i=e.classList;if(t&&g(e,t)){if(i)i.remove(t);else{for(r=" "+t+" ",n=" "+b(e,"class")+" ";n.indexOf(r)>-1;)n=n.replace(r," ");y(e,"class",n.trim())}e.className||m(e,"class")}}(n.el,e)});e.split(" ").map(function(e){var t,r,i,o;t=n.el,r=e,o=t.classList,r&&!g(t,r)&&(o?o.add(r):-1===(i=" "+b(t,"class")+" ").indexOf(" "+r+" ")&&y(t,"class",(i+r).trim()))})}}]),t}(),V=function(e){function t(e,n,r){var u;l(this,t),(u=i(this,o(t).call(this,e,n,r))).init=!0,u.parent=e.parentNode,u.end=e.nextSibling,u.start=e.previousSibling;var s=n.match(/(.*) (?:in|of) (.*)/);return u.alias=s[1],u.dirValue=s[2],u}return u(t,S),c(t,[{key:"update",value:function(e,t,n){if(this.init){this.el.parentNode.replaceChild(this.buildList(e),this.el),this.init=!1}else{var r="push|pop|shift|unshift|splice".split("|");n&&r.indexOf(n.method)>-1?this.updatePartly(e,n):this.recompileList(e)}}},{key:"buildList",value:function(e,t){var n=this,r=document.createDocumentFragment(),i=t||0,o=this.el.cloneNode(!0);return e.map(function(e,t){var u=o.cloneNode(!0),s=i+t,a=Object.create(n.vm.$data),c=n.alias;E.observe(a,c,e),E.observe(a,"$index",s),n.vm.collectDir(u,!0,a),r.appendChild(u)}),r}},{key:"updatePartly",value:function(e,t){this[t.method].call(this,e,t.args)}},{key:"recompileList",value:function(e){for(var t=this.parent,n=t.childNodes,r=0;r<n.length;r++)t.removeChild(n[r]),r--;var i=this.buildList(e);t.insertBefore(i,this.end)}},{key:"push",value:function(e,t){var n=this.buildList(t,e.length-1);this.parent.insertBefore(n,this.end)}},{key:"unshift",value:function(e,t){var n=this.buildList(t,0);this.parent.insertBefore(n,this.start)}},{key:"pop",value:function(){this.removeChild(this.end.previousSibling)}},{key:"shift",value:function(){this.removeChild(this.start.nextSibling)}},{key:"spilce",value:function(){}}]),t}(),N=function(e){function t(e,n,r){return l(this,t),i(this,o(t).call(this,e,n,r))}return u(t,S),c(t,[{key:"update",value:function(e){y(this.el,this.dirValue,e)}}]),t}(),T=function(){function e(t,n){l(this,e),this.watchers=[],this.vm=t.vm,this.el=t.el,this.dirValue=t.dirValue,this.callback=t.update,this.depIds=[],this.oldVal=null,this.parser=t,this.scope=n,this.value=this.get()}return c(e,[{key:"get",value:function(){j=this;var e=this._getter(this.dirValue)(this.scope||this.vm.$data);return j=null,e}},{key:"_getter",value:function(e){return new Function("scope","return scope."+e+";")}},{key:"beforeUpdate",value:function(){this.oldVal=function(e){var t=history.state;history.replaceState(e,document.title);var n=history.state;return history.replaceState(t,document.title),n}(this.value)}},{key:"update",value:function(e){var t=this.value=this.get();this.callback.call(this.parser,t,this.oldVal,e)}}]),e}(),E=function(){function e(t){l(this,e),this.dependList=[],f(t)?this.observeArray(t):this.observeObject(t),Object.defineProperty(t,"__ob__",{value:this,writable:!0,enumerable:!1,configurable:!0})}return c(e,[{key:"observeObject",value:function(t){for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r];e.observe(t,i,t[i])}}},{key:"observeArray",value:function(t){this.extendArrayProto(t),t.map(function(t){e.createObserver(t)})}},{key:"extendArrayProto",value:function(e){var t=Array.prototype,n=Object.create(t),r=this;["pop","push","sort","shift","splice","unshift","reverse"].map(function(e){Object.defineProperty(n,e,{value:function(){for(var n=this,i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];var s=this.__ob__;s.dependList.map(function(e){e.beforeUpdate()});var a,c=t[e],l=c.apply.apply(c,[this].concat(o));switch(e){case"push":case"unshift":a=o;break;case"splice":a=o.slice(2)}return a&&a.length&&r.observeArray(a),s.dependList.map(function(t){t.update({method:e,args:o,source:n})}),l},writable:!0,enumerable:!1,configurable:!0})}),e.__proto__=n}}],[{key:"observe",value:function(t,n,r){var i=[],o=x++,u=e.createObserver(r);Object.defineProperty(t,n,{get:function(){return j&&j.depIds.indexOf(o)<0&&(j.depIds.push(o),i.push(j),u&&u.dependList.push(j)),r},set:function(t){t!==r&&(i.map(function(e){e.beforeUpdate()}),r=t,e.createObserver(t),i.map(function(e){e.update()}))}})}},{key:"createObserver",value:function(t){if(f(t)||h(t))return t.hasOwnProperty("__ob__")?t.__ob__:new e(t)}}]),e}()}])});